import{_ as s,c as a,o as i,V as n}from"./chunks/framework.szLWUyCm.js";const g=JSON.parse('{"title":"四、ORM模型迁移","description":"","frontmatter":{},"headers":[],"relativePath":"rear/flask/ORM模型迁移.md","filePath":"rear/flask/ORM模型迁移.md","lastUpdated":null}'),e={name:"rear/flask/ORM模型迁移.md"},l=n(`<h1 id="四、orm模型迁移" tabindex="-1">四、ORM模型迁移 <a class="header-anchor" href="#四、orm模型迁移" aria-label="Permalink to &quot;四、ORM模型迁移&quot;">​</a></h1><h2 id="一、安装flask-migrate" tabindex="-1">一、安装flask-migrate <a class="header-anchor" href="#一、安装flask-migrate" aria-label="Permalink to &quot;一、安装flask-migrate&quot;">​</a></h2><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pip</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install flask-migrate</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h2 id="二、引入flask-migrate" tabindex="-1">二、引入flask-migrate <a class="header-anchor" href="#二、引入flask-migrate" aria-label="Permalink to &quot;二、引入flask-migrate&quot;">​</a></h2><div class="language-py vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">py</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> flask_migrate </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Migrate</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">app </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Flask(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">__name__</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># xxxxxx</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 创建实例对象</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">db </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> SQLAlchemy(app)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">migrate</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Migrate(app,db)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h2 id="三" tabindex="-1">三 <a class="header-anchor" href="#三" aria-label="Permalink to &quot;三&quot;">​</a></h2><h2 id="、映射" tabindex="-1">、映射 <a class="header-anchor" href="#、映射" aria-label="Permalink to &quot;、映射&quot;">​</a></h2><p>初始化操作只需要执行<code>一次</code>，其他的操作<code>每次</code>都要执行</p><h3 id="_1、初始化数据库迁移环境" tabindex="-1">1、初始化数据库迁移环境 <a class="header-anchor" href="#_1、初始化数据库迁移环境" aria-label="Permalink to &quot;1、初始化数据库迁移环境&quot;">​</a></h3><blockquote><p><code>flask db init</code> 命令用于创建一个名为 migrations 的目录，该目录用于存储数据库迁移脚本和其他相关文件</p></blockquote><div class="language-py vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">py</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">flask db init</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>如果报错：</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>PS E:\\code\\flask\\Flask\\草稿\\flaskProject1&gt; flask db init</span></span>
<span class="line"><span>Usage: flask db init [OPTIONS]</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Error: Could not locate Flask application. You did not provide the FLASK_APP environment variable.</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>打开CMD终端</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> FLASK_APP=app.py  应用程序入口文件</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> FLASK_ENV=development</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">flask</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> db init</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>命令执行完成后，会在项目的根路径下生成一个<code>migrations</code>文件夹，在这个文件夹下有以下文件或文件夹</p><ol><li><code>versions</code>:文件夹，用于存放后面生成的迁移脚本文件。由于目前没有生成过任何迁移脚本，因此是一个空的文件夹。</li><li><code>alembic.ini</code>: alembic 的配置文件。</li><li><code>env.py</code>:配合Flask 项目进行迁移的 Python 文件。</li><li><code>script.py.mako</code>:生成迁移脚本的模板文件。</li></ol><h3 id="_2、识别orm模型的改变-生成迁移脚本" tabindex="-1">2、识别ORM模型的改变，生成迁移脚本 <a class="header-anchor" href="#_2、识别orm模型的改变-生成迁移脚本" aria-label="Permalink to &quot;2、识别ORM模型的改变，生成迁移脚本&quot;">​</a></h3><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">flask</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> db migrate </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-m</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;备注信息&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>结果（此时User表和Artice表已被删了）</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">INFO</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  [alembic.runtime.migration] Context impl MySQLImpl.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">INFO</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  [alembic.runtime.migration] Will assume non-transactional DDL.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">INFO</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  [alembic.autogenerate.compare] Detected added table </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;user&#39;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">INFO</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  [alembic.autogenerate.compare] Detected added table </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;article&#39;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Generating</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> E:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\c</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ode</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">lask</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\F</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">lask</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\草</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">稿</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">laskProject1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\m</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">igrations</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\v</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ersions</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">a78b3fcab49_.py ... done</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><blockquote><p>参数<code>-m</code>后面跟的是备注信息，通过添加备注信息，可方便以后查看当前迁移脚本做了哪些事情。当然，备注信息不是必需的，如果不想添加，则把参数以及后面的内容都删除即可。</p></blockquote><h3 id="_3、运行迁移脚本-同步到数据库" tabindex="-1">3、运行迁移脚本，同步到数据库 <a class="header-anchor" href="#_3、运行迁移脚本-同步到数据库" aria-label="Permalink to &quot;3、运行迁移脚本，同步到数据库&quot;">​</a></h3><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">flask</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> db upgrade</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div>`,24),p=[l];function t(h,r,k,d,c,o){return i(),a("div",null,p)}const u=s(e,[["render",t]]);export{g as __pageData,u as default};
